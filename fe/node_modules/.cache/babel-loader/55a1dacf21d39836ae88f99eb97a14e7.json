{"ast":null,"code":"import _classCallCheck from \"/Users/bobby.hewitt/Documents/test/ops/fe/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/bobby.hewitt/Documents/test/ops/fe/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/bobby.hewitt/Documents/test/ops/fe/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/bobby.hewitt/Documents/test/ops/fe/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/bobby.hewitt/Documents/test/ops/fe/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/Users/bobby.hewitt/Documents/test/ops/fe/src/containers/Quiz/Host/index.js\";\nimport React, { Component } from 'react';\nimport { push as _push } from 'connected-react-router';\nimport { bindActionCreators } from 'redux';\nimport { connect } from 'react-redux';\nimport SocketListener from 'containers/SocketListener/Quiz';\nimport { showQuestionSocket } from 'sockets/Quiz/host';\nimport { updatePlayers } from 'actions/general/host';\nimport { setupGame, showAnswer, showScores, showQuestionHost } from 'actions/quiz/host';\nimport './style.scss';\nimport Question from './Question';\nimport PlayerResponse from './PlayerResponse';\n\nvar QuizHost =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(QuizHost, _Component);\n\n  function QuizHost(props) {\n    var _this;\n\n    _classCallCheck(this, QuizHost);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(QuizHost).call(this, props));\n    _this.timeout = null;\n    _this.state = {};\n    return _this;\n  }\n\n  _createClass(QuizHost, [{\n    key: \"componentWillMount\",\n    value: function componentWillMount() {\n      this.setupGame();\n    }\n  }, {\n    key: \"getNumberOfTruthies\",\n    value: function getNumberOfTruthies(array) {\n      var count = 0;\n\n      for (var i = 0; i < array.length; i++) {\n        if (array[i]) count += 1;\n      }\n\n      return count;\n    }\n  }, {\n    key: \"compareResponsesToPlayers\",\n    value: function compareResponsesToPlayers(responses) {\n      var players = this.props.players.length;\n      var allPlayersHaveResponded = true;\n\n      for (var i = 0; i < players.length; i++) {\n        if (players[i]) {\n          var hasResponded = responses.find(function (r) {\n            return r.id === players[i].id;\n          });\n\n          if (!hasResponded) {\n            allPlayersHaveResponded = false;\n          }\n        }\n      }\n\n      if (allPlayersHaveResponded) {\n        console.log('All responses recieved ');\n        this.calculateScores(responses);\n      } else {\n        console.log('Not recieved all responses');\n      }\n    }\n  }, {\n    key: \"componentWillReceiveProps\",\n    value: function componentWillReceiveProps(np) {\n      if (this.props.responses.length !== np.responses.length && np.responses.length) {\n        //check to see if all active players have responded\n        this.compareResponsesToPlayers(np.responses);\n      }\n    }\n  }, {\n    key: \"shuffle\",\n    value: function shuffle(array) {\n      var currentIndex = array.length,\n          temporaryValue,\n          randomIndex;\n\n      while (0 !== currentIndex) {\n        randomIndex = Math.floor(Math.random() * currentIndex);\n        currentIndex -= 1;\n        temporaryValue = array[currentIndex];\n        array[currentIndex] = array[randomIndex];\n        array[randomIndex] = temporaryValue;\n      }\n\n      return array;\n    }\n  }, {\n    key: \"setupGame\",\n    value: function setupGame() {\n      var _this2 = this;\n\n      fetch('https://opentdb.com/api.php?amount=10&type=multiple').then(function (resp) {\n        return resp.json();\n      }).then(function (data) {\n        //reset scores\n        for (var i = 0; i < _this2.props.players.length; i++) {\n          if (_this2.props.players[i]) _this2.props.players[i].score = 0;\n        }\n\n        _this2.props.updatePlayers(_this2.props.players); //shuffle incorrect and correct answers together and note the position of correct answer\n\n\n        for (var _i = 0; _i < data.results.length; _i++) {\n          var q = data.results[_i];\n          q.all_answers = q.incorrect_answers;\n          q.all_answers.push(q.correct_answer);\n          q.all_answers = _this2.shuffle(q.all_answers);\n          q.correct_index = q.all_answers.indexOf(q.correct_answer);\n        }\n\n        _this2.props.setupGame({\n          questions: data.results\n        });\n\n        _this2.intro();\n      }).catch(function (err) {\n        console.log('error fetchi9ng data', err);\n      });\n    }\n  }, {\n    key: \"intro\",\n    value: function intro() {\n      this.showQuestion();\n    }\n  }, {\n    key: \"showQuestion\",\n    value: function showQuestion() {\n      showQuestionSocket(this, this.props.socket);\n    }\n  }, {\n    key: \"showAnswer\",\n    value: function showAnswer() {\n      var _this3 = this;\n\n      this.timeout = setTimeout(function () {\n        _this3.props.showAnswer();\n      }, 1000);\n      this.timeout = setTimeout(function () {\n        showQuestionSocket(_this3, _this3.props.socket);\n      }, 7000);\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      clearTimeout(this.timeout);\n    }\n  }, {\n    key: \"calculateScores\",\n    value: function calculateScores(responses) {\n      var players = this.props.players;\n      var startTime = this.props.startTime;\n      var foundFirstCorrectAnswer = false;\n\n      for (var i = 0; i < responses.length; i++) {\n        for (var j = 0; j < players.length; j++) {\n          if (players[j] && responses[i].id === players[j].id) {\n            if (responses[i].correct) {\n              players[j].score += 100;\n\n              if (!foundFirstCorrectAnswer) {\n                players[j].score += 50;\n                players[j].bonus = true;\n                foundFirstCorrectAnswer = true;\n              } else {\n                players[j].bonus = false;\n              }\n            } else {\n              players[j].bonus = false;\n            }\n          }\n        }\n      }\n\n      this.props.updatePlayers(players);\n      this.showAnswer();\n    }\n  }, {\n    key: \"showScores\",\n    value: function showScores() {\n      this.props.showScores(); //move to next question index.\n      //reset timings\n      //reset responses\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this4 = this;\n\n      var currentQuestion = this.props.currentQuestion;\n      return React.createElement(\"div\", {\n        className: \"quizHostContainer\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 165\n        },\n        __self: this\n      }, React.createElement(SocketListener, {\n        isHost: true,\n        socket: this.props.socket,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 166\n        },\n        __self: this\n      }), this.props.quizState === 'break' && React.createElement(\"p\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 168\n        },\n        __self: this\n      }, \"Break\"), (this.props.quizState === 'question' || this.props.quizState === 'answer') && React.createElement(\"div\", {\n        className: \"sceneContainer\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 171\n        },\n        __self: this\n      }, React.createElement(Question, {\n        question: currentQuestion,\n        quizState: this.props.quizState,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 172\n        },\n        __self: this\n      }), React.createElement(\"div\", {\n        className: \"responsesContainerHost\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 173\n        },\n        __self: this\n      }, this.props.players && this.props.players.map(function (player, i) {\n        if (player) {\n          return React.createElement(PlayerResponse, Object.assign({\n            key: i,\n            bonus: player.bonus,\n            response: _this4.props.responses.find(function (r) {\n              return r.id === player.id;\n            })\n          }, player, {\n            quizState: _this4.props.quizState,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 177\n            },\n            __self: this\n          }));\n        } else {\n          return React.createElement(\"div\", {\n            key: i,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 181\n            },\n            __self: this\n          });\n        }\n      }))), this.props.quizState === 'end' && React.createElement(\"p\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 189\n        },\n        __self: this\n      }, \"End\"));\n    }\n  }]);\n\n  return QuizHost;\n}(Component);\n\nvar mapStateToProps = function mapStateToProps(state) {\n  return {\n    room: state.generalHost.room,\n    startTime: state.quizHost.startTime,\n    players: state.generalHost.players,\n    router: state.router,\n    responses: state.quizHost.responses,\n    quizPlayers: state.quizHost.players,\n    currentQuestion: state.quizHost.currentQuestion,\n    quizState: state.quizHost.quizState\n  };\n};\n\nvar mapDispatchToProps = function mapDispatchToProps(dispatch) {\n  return bindActionCreators({\n    push: function push(path) {\n      return _push(path);\n    },\n    setupGame: setupGame,\n    updatePlayers: updatePlayers,\n    showAnswer: showAnswer,\n    showQuestionHost: showQuestionHost,\n    showScores: showScores\n  }, dispatch);\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(QuizHost);","map":{"version":3,"sources":["/Users/bobby.hewitt/Documents/test/ops/fe/src/containers/Quiz/Host/index.js"],"names":["React","Component","push","bindActionCreators","connect","SocketListener","showQuestionSocket","updatePlayers","setupGame","showAnswer","showScores","showQuestionHost","Question","PlayerResponse","QuizHost","props","timeout","state","array","count","i","length","responses","players","allPlayersHaveResponded","hasResponded","find","r","id","console","log","calculateScores","np","compareResponsesToPlayers","currentIndex","temporaryValue","randomIndex","Math","floor","random","fetch","then","resp","json","data","score","results","q","all_answers","incorrect_answers","correct_answer","shuffle","correct_index","indexOf","questions","intro","catch","err","showQuestion","socket","setTimeout","clearTimeout","startTime","foundFirstCorrectAnswer","j","correct","bonus","currentQuestion","quizState","map","player","mapStateToProps","room","generalHost","quizHost","router","quizPlayers","mapDispatchToProps","dispatch","path"],"mappings":";;;;;;AAAA,OAAOA,KAAP,IAAgBC,SAAhB,QAAiC,OAAjC;AACA,SAASC,IAAI,IAAJA,KAAT,QAAqB,wBAArB;AACA,SAASC,kBAAT,QAAmC,OAAnC;AACA,SAASC,OAAT,QAAwB,aAAxB;AAEA,OAAOC,cAAP,MAA2B,gCAA3B;AACA,SAASC,kBAAT,QAAmC,mBAAnC;AACA,SAASC,aAAT,QAA8B,sBAA9B;AACA,SAASC,SAAT,EAAoBC,UAApB,EAAgCC,UAAhC,EAA4CC,gBAA5C,QAAoE,mBAApE;AACA,OAAO,cAAP;AACA,OAAOC,QAAP,MAAqB,YAArB;AACA,OAAOC,cAAP,MAA2B,kBAA3B;;IACMC,Q;;;;;AAEL,oBAAYC,KAAZ,EAAkB;AAAA;;AAAA;;AACjB,kFAAMA,KAAN;AACA,UAAKC,OAAL,GAAe,IAAf;AACA,UAAKC,KAAL,GAAa,EAAb;AAHiB;AAMjB;;;;yCAEmB;AACnB,WAAKT,SAAL;AACA;;;wCAEmBU,K,EAAM;AACzB,UAAIC,KAAK,GAAG,CAAZ;;AACA,WAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGF,KAAK,CAACG,MAA1B,EAAkCD,CAAC,EAAnC,EAAsC;AACrC,YAAGF,KAAK,CAACE,CAAD,CAAR,EAAaD,KAAK,IAAI,CAAT;AACb;;AACD,aAAOA,KAAP;AACA;;;8CAIyBG,S,EAAU;AACnC,UAAIC,OAAO,GAAG,KAAKR,KAAL,CAAWQ,OAAX,CAAmBF,MAAjC;AACA,UAAIG,uBAAuB,GAAG,IAA9B;;AACA,WAAK,IAAIJ,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGG,OAAO,CAACF,MAA5B,EAAoCD,CAAC,EAArC,EAAwC;AACvC,YAAIG,OAAO,CAACH,CAAD,CAAX,EAAe;AACd,cAAIK,YAAY,GAAGH,SAAS,CAACI,IAAV,CAAe,UAAAC,CAAC;AAAA,mBAAIA,CAAC,CAACC,EAAF,KAASL,OAAO,CAACH,CAAD,CAAP,CAAWQ,EAAxB;AAAA,WAAhB,CAAnB;;AACA,cAAI,CAACH,YAAL,EAAkB;AACjBD,YAAAA,uBAAuB,GAAG,KAA1B;AACA;AACD;AACD;;AACD,UAAIA,uBAAJ,EAA4B;AAC3BK,QAAAA,OAAO,CAACC,GAAR,CAAY,yBAAZ;AACA,aAAKC,eAAL,CAAqBT,SAArB;AACA,OAHD,MAGO;AACNO,QAAAA,OAAO,CAACC,GAAR,CAAY,4BAAZ;AACA;AACD;;;8CAEyBE,E,EAAG;AAC5B,UAAI,KAAKjB,KAAL,CAAWO,SAAX,CAAqBD,MAArB,KAAgCW,EAAE,CAACV,SAAH,CAAaD,MAA7C,IAAuDW,EAAE,CAACV,SAAH,CAAaD,MAAxE,EAA+E;AAC9E;AAEA,aAAKY,yBAAL,CAA+BD,EAAE,CAACV,SAAlC;AACA;AACD;;;4BAEOJ,K,EAAO;AACb,UAAIgB,YAAY,GAAGhB,KAAK,CAACG,MAAzB;AAAA,UAAiCc,cAAjC;AAAA,UAAiDC,WAAjD;;AACA,aAAO,MAAMF,YAAb,EAA2B;AACzBE,QAAAA,WAAW,GAAGC,IAAI,CAACC,KAAL,CAAWD,IAAI,CAACE,MAAL,KAAgBL,YAA3B,CAAd;AACAA,QAAAA,YAAY,IAAI,CAAhB;AACAC,QAAAA,cAAc,GAAGjB,KAAK,CAACgB,YAAD,CAAtB;AACAhB,QAAAA,KAAK,CAACgB,YAAD,CAAL,GAAsBhB,KAAK,CAACkB,WAAD,CAA3B;AACAlB,QAAAA,KAAK,CAACkB,WAAD,CAAL,GAAqBD,cAArB;AACD;;AACD,aAAOjB,KAAP;AACD;;;gCAEU;AAAA;;AACVsB,MAAAA,KAAK,CAAC,qDAAD,CAAL,CACEC,IADF,CACO,UAACC,IAAD;AAAA,eAAUA,IAAI,CAACC,IAAL,EAAV;AAAA,OADP,EAEEF,IAFF,CAEO,UAACG,IAAD,EAAU;AAChB;AACA,aAAK,IAAIxB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,MAAI,CAACL,KAAL,CAAWQ,OAAX,CAAmBF,MAAvC,EAA+CD,CAAC,EAAhD,EAAmD;AAClD,cAAI,MAAI,CAACL,KAAL,CAAWQ,OAAX,CAAmBH,CAAnB,CAAJ,EAA0B,MAAI,CAACL,KAAL,CAAWQ,OAAX,CAAmBH,CAAnB,EAAsByB,KAAtB,GAA8B,CAA9B;AAC1B;;AACD,QAAA,MAAI,CAAC9B,KAAL,CAAWR,aAAX,CAAyB,MAAI,CAACQ,KAAL,CAAWQ,OAApC,EALgB,CAMhB;;;AACA,aAAK,IAAIH,EAAC,GAAG,CAAb,EAAgBA,EAAC,GAAGwB,IAAI,CAACE,OAAL,CAAazB,MAAjC,EAAyCD,EAAC,EAA1C,EAA6C;AAC5C,cAAI2B,CAAC,GAAGH,IAAI,CAACE,OAAL,CAAa1B,EAAb,CAAR;AACA2B,UAAAA,CAAC,CAACC,WAAF,GAAgBD,CAAC,CAACE,iBAAlB;AACAF,UAAAA,CAAC,CAACC,WAAF,CAAc9C,IAAd,CAAmB6C,CAAC,CAACG,cAArB;AACAH,UAAAA,CAAC,CAACC,WAAF,GAAgB,MAAI,CAACG,OAAL,CAAaJ,CAAC,CAACC,WAAf,CAAhB;AACAD,UAAAA,CAAC,CAACK,aAAF,GAAkBL,CAAC,CAACC,WAAF,CAAcK,OAAd,CAAsBN,CAAC,CAACG,cAAxB,CAAlB;AACA;;AACD,QAAA,MAAI,CAACnC,KAAL,CAAWP,SAAX,CAAqB;AAAC8C,UAAAA,SAAS,EAAEV,IAAI,CAACE;AAAjB,SAArB;;AACA,QAAA,MAAI,CAACS,KAAL;AACA,OAlBD,EAmBCC,KAnBD,CAmBO,UAACC,GAAD,EAAS;AACf5B,QAAAA,OAAO,CAACC,GAAR,CAAY,sBAAZ,EAAoC2B,GAApC;AACA,OArBD;AAsBA;;;4BAEM;AACN,WAAKC,YAAL;AACA;;;mCAEa;AACbpD,MAAAA,kBAAkB,CAAC,IAAD,EAAO,KAAKS,KAAL,CAAW4C,MAAlB,CAAlB;AACA;;;iCAEW;AAAA;;AACX,WAAK3C,OAAL,GAAe4C,UAAU,CAAC,YAAM;AAC/B,QAAA,MAAI,CAAC7C,KAAL,CAAWN,UAAX;AACA,OAFwB,EAEvB,IAFuB,CAAzB;AAGA,WAAKO,OAAL,GAAe4C,UAAU,CAAC,YAAM;AAC/BtD,QAAAA,kBAAkB,CAAC,MAAD,EAAO,MAAI,CAACS,KAAL,CAAW4C,MAAlB,CAAlB;AACA,OAFwB,EAEvB,IAFuB,CAAzB;AAGA;;;2CAEqB;AACrBE,MAAAA,YAAY,CAAC,KAAK7C,OAAN,CAAZ;AACA;;;oCAEeM,S,EAAU;AACzB,UAAIC,OAAO,GAAG,KAAKR,KAAL,CAAWQ,OAAzB;AACA,UAAIuC,SAAS,GAAG,KAAK/C,KAAL,CAAW+C,SAA3B;AACA,UAAIC,uBAAuB,GAAG,KAA9B;;AACA,WAAK,IAAI3C,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGE,SAAS,CAACD,MAA9B,EAAsCD,CAAC,EAAvC,EAA0C;AACzC,aAAK,IAAI4C,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGzC,OAAO,CAACF,MAA5B,EAAoC2C,CAAC,EAArC,EAAwC;AACvC,cAAIzC,OAAO,CAACyC,CAAD,CAAP,IAAc1C,SAAS,CAACF,CAAD,CAAT,CAAaQ,EAAb,KAAoBL,OAAO,CAACyC,CAAD,CAAP,CAAWpC,EAAjD,EAAoD;AACnD,gBAAIN,SAAS,CAACF,CAAD,CAAT,CAAa6C,OAAjB,EAAyB;AACxB1C,cAAAA,OAAO,CAACyC,CAAD,CAAP,CAAWnB,KAAX,IAAoB,GAApB;;AACA,kBAAI,CAACkB,uBAAL,EAA6B;AAC5BxC,gBAAAA,OAAO,CAACyC,CAAD,CAAP,CAAWnB,KAAX,IAAoB,EAApB;AACAtB,gBAAAA,OAAO,CAACyC,CAAD,CAAP,CAAWE,KAAX,GAAmB,IAAnB;AACAH,gBAAAA,uBAAuB,GAAG,IAA1B;AACA,eAJD,MAIO;AACNxC,gBAAAA,OAAO,CAACyC,CAAD,CAAP,CAAWE,KAAX,GAAmB,KAAnB;AACA;AACD,aATD,MASO;AACN3C,cAAAA,OAAO,CAACyC,CAAD,CAAP,CAAWE,KAAX,GAAmB,KAAnB;AACA;AACD;AACD;AACD;;AACD,WAAKnD,KAAL,CAAWR,aAAX,CAAyBgB,OAAzB;AACA,WAAKd,UAAL;AACA;;;iCAEW;AAEX,WAAKM,KAAL,CAAWL,UAAX,GAFW,CAGX;AACA;AACA;AACA;;;6BAQO;AAAA;;AAAA,UACCyD,eADD,GACqB,KAAKpD,KAD1B,CACCoD,eADD;AAEP,aACC;AAAK,QAAA,SAAS,EAAC,mBAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACA,oBAAC,cAAD;AAAgB,QAAA,MAAM,MAAtB;AAAuB,QAAA,MAAM,EAAE,KAAKpD,KAAL,CAAW4C,MAA1C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADA,EAEE,KAAK5C,KAAL,CAAWqD,SAAX,KAAyB,OAAzB,IACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iBAHF,EAKE,CAAC,KAAKrD,KAAL,CAAWqD,SAAX,KAAyB,UAAzB,IAAuC,KAAKrD,KAAL,CAAWqD,SAAX,KAAyB,QAAjE,KACA;AAAK,QAAA,SAAS,EAAC,gBAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACA,oBAAC,QAAD;AAAU,QAAA,QAAQ,EAAED,eAApB;AAAqC,QAAA,SAAS,EAAE,KAAKpD,KAAL,CAAWqD,SAA3D;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADA,EAEA;AAAK,QAAA,SAAS,EAAC,wBAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACE,KAAKrD,KAAL,CAAWQ,OAAX,IAAsB,KAAKR,KAAL,CAAWQ,OAAX,CAAmB8C,GAAnB,CAAuB,UAACC,MAAD,EAASlD,CAAT,EAAe;AAC5D,YAAIkD,MAAJ,EAAW;AACV,iBACC,oBAAC,cAAD;AAAgB,YAAA,GAAG,EAAElD,CAArB;AAAwB,YAAA,KAAK,EAAEkD,MAAM,CAACJ,KAAtC;AAA6C,YAAA,QAAQ,EAAE,MAAI,CAACnD,KAAL,CAAWO,SAAX,CAAqBI,IAArB,CAA0B,UAAAC,CAAC;AAAA,qBAAIA,CAAC,CAACC,EAAF,KAAS0C,MAAM,CAAC1C,EAApB;AAAA,aAA3B;AAAvD,aAA+G0C,MAA/G;AAAuH,YAAA,SAAS,EAAE,MAAI,CAACvD,KAAL,CAAWqD,SAA7I;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,aADD;AAGA,SAJD,MAIO;AACN,iBACC;AAAK,YAAA,GAAG,EAAEhD,CAAV;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,YADD;AAGA;AACD,OAVsB,CADxB,CAFA,CANF,EAuBE,KAAKL,KAAL,CAAWqD,SAAX,KAAyB,KAAzB,IACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,eAxBF,CADD;AA6BA;;;;EApLqBnE,S;;AAwLvB,IAAMsE,eAAe,GAAG,SAAlBA,eAAkB,CAAAtD,KAAK;AAAA,SAAK;AACjCuD,IAAAA,IAAI,EAAEvD,KAAK,CAACwD,WAAN,CAAkBD,IADS;AAEjCV,IAAAA,SAAS,EAAE7C,KAAK,CAACyD,QAAN,CAAeZ,SAFO;AAGjCvC,IAAAA,OAAO,EAAEN,KAAK,CAACwD,WAAN,CAAkBlD,OAHM;AAIjCoD,IAAAA,MAAM,EAAE1D,KAAK,CAAC0D,MAJmB;AAKjCrD,IAAAA,SAAS,EAAEL,KAAK,CAACyD,QAAN,CAAepD,SALO;AAMjCsD,IAAAA,WAAW,EAAE3D,KAAK,CAACyD,QAAN,CAAenD,OANK;AAOjC4C,IAAAA,eAAe,EAAElD,KAAK,CAACyD,QAAN,CAAeP,eAPC;AAQjCC,IAAAA,SAAS,EAAEnD,KAAK,CAACyD,QAAN,CAAeN;AARO,GAAL;AAAA,CAA7B;;AAYA,IAAMS,kBAAkB,GAAG,SAArBA,kBAAqB,CAAAC,QAAQ;AAAA,SAAI3E,kBAAkB,CAAC;AACxDD,IAAAA,IAAI,EAAE,cAAC6E,IAAD;AAAA,aAAU7E,KAAI,CAAC6E,IAAD,CAAd;AAAA,KADkD;AAExDvE,IAAAA,SAAS,EAATA,SAFwD;AAGxDD,IAAAA,aAAa,EAAbA,aAHwD;AAIxDE,IAAAA,UAAU,EAAVA,UAJwD;AAKxDE,IAAAA,gBAAgB,EAAhBA,gBALwD;AAMxDD,IAAAA,UAAU,EAAVA;AANwD,GAAD,EAOtDoE,QAPsD,CAAtB;AAAA,CAAnC;;AASA,eAAe1E,OAAO,CACpBmE,eADoB,EAEpBM,kBAFoB,CAAP,CAGb/D,QAHa,CAAf","sourcesContent":["import React, { Component } from 'react'\nimport { push } from 'connected-react-router'\nimport { bindActionCreators } from 'redux'\nimport { connect } from 'react-redux'\n\nimport SocketListener from 'containers/SocketListener/Quiz'\nimport { showQuestionSocket } from 'sockets/Quiz/host'\nimport { updatePlayers } from 'actions/general/host'\nimport { setupGame, showAnswer, showScores, showQuestionHost } from 'actions/quiz/host'\nimport './style.scss'\nimport Question from './Question'\nimport PlayerResponse from './PlayerResponse'\nclass QuizHost extends Component {\n\n\tconstructor(props){\n\t\tsuper(props)\n\t\tthis.timeout = null\n\t\tthis.state = {\n\n\t\t}\n\t}\n\n\tcomponentWillMount(){\n\t\tthis.setupGame()\n\t}\n\n\tgetNumberOfTruthies(array){\n\t\tlet count = 0\n\t\tfor (var i = 0; i < array.length; i++){\n\t\t\tif(array[i]) count += 1\n\t\t}\n\t\treturn count\n\t}\n\n\n\n\tcompareResponsesToPlayers(responses){\n\t\tlet players = this.props.players.length;\n\t\tlet allPlayersHaveResponded = true;\n\t\tfor (var i = 0; i < players.length; i++){\n\t\t\tif (players[i]){\n\t\t\t\tlet hasResponded = responses.find(r => r.id === players[i].id)\n\t\t\t\tif (!hasResponded){\n\t\t\t\t\tallPlayersHaveResponded = false\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (allPlayersHaveResponded){\n\t\t\tconsole.log('All responses recieved ')\n\t\t\tthis.calculateScores(responses)\n\t\t} else {\n\t\t\tconsole.log('Not recieved all responses')\n\t\t}\n\t}\n\n\tcomponentWillReceiveProps(np){\n\t\tif (this.props.responses.length !== np.responses.length && np.responses.length){\n\t\t\t//check to see if all active players have responded\n\n\t\t\tthis.compareResponsesToPlayers(np.responses)\n\t\t}\n\t}\n\n\tshuffle(array) {\n\t  var currentIndex = array.length, temporaryValue, randomIndex;\n\t  while (0 !== currentIndex) {\n\t    randomIndex = Math.floor(Math.random() * currentIndex);\n\t    currentIndex -= 1;\n\t    temporaryValue = array[currentIndex];\n\t    array[currentIndex] = array[randomIndex];\n\t    array[randomIndex] = temporaryValue;\n\t  }\n\t  return array;\n\t}\n\n\tsetupGame(){\n\t\tfetch('https://opentdb.com/api.php?amount=10&type=multiple')\n\t\t\t.then((resp) => resp.json())\n\t\t\t.then((data) => {\n\t\t\t//reset scores\n\t\t\tfor (var i = 0; i < this.props.players.length; i++){\n\t\t\t\tif (this.props.players[i])this.props.players[i].score = 0\t\t\t\n\t\t\t}\n\t\t\tthis.props.updatePlayers(this.props.players)\n\t\t\t//shuffle incorrect and correct answers together and note the position of correct answer\n\t\t\tfor (let i = 0; i < data.results.length; i++){\n\t\t\t\tlet q = data.results[i]\n\t\t\t\tq.all_answers = q.incorrect_answers\n\t\t\t\tq.all_answers.push(q.correct_answer) \n\t\t\t\tq.all_answers = this.shuffle(q.all_answers)\n\t\t\t\tq.correct_index = q.all_answers.indexOf(q.correct_answer)\n\t\t\t}\n\t\t\tthis.props.setupGame({questions: data.results})\n\t\t\tthis.intro()\n\t\t})\n\t\t.catch((err) => {\n\t\t\tconsole.log('error fetchi9ng data', err)\n\t\t})\n\t}\n\n\tintro(){\t\n\t\tthis.showQuestion()\n\t}\n\n\tshowQuestion(){\n\t\tshowQuestionSocket(this, this.props.socket)\n\t}\n\n\tshowAnswer(){\n\t\tthis.timeout = setTimeout(() => {\n\t\t\tthis.props.showAnswer()\n\t\t},1000)\n\t\tthis.timeout = setTimeout(() => {\n\t\t\tshowQuestionSocket(this, this.props.socket)\n\t\t},7000)\n\t}\n\n\tcomponentWillUnmount(){\n\t\tclearTimeout(this.timeout)\n\t}\n\n\tcalculateScores(responses){\n\t\tlet players = this.props.players\n\t\tlet startTime = this.props.startTime\n\t\tlet foundFirstCorrectAnswer = false\n\t\tfor (var i = 0; i < responses.length; i++){\t\n\t\t\tfor (var j = 0; j < players.length; j++){\n\t\t\t\tif (players[j] && responses[i].id === players[j].id){\n\t\t\t\t\tif (responses[i].correct){\n\t\t\t\t\t\tplayers[j].score += 100\n\t\t\t\t\t\tif (!foundFirstCorrectAnswer){\n\t\t\t\t\t\t\tplayers[j].score += 50\n\t\t\t\t\t\t\tplayers[j].bonus = true\n\t\t\t\t\t\t\tfoundFirstCorrectAnswer = true\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tplayers[j].bonus = false\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tplayers[j].bonus = false\n\t\t\t\t\t}\t\n\t\t\t\t}\n\t\t\t} \n\t\t}\n\t\tthis.props.updatePlayers(players)\n\t\tthis.showAnswer()\n\t}\n\n\tshowScores(){\n\n\t\tthis.props.showScores()\n\t\t//move to next question index.\n\t\t//reset timings\n\t\t//reset responses\n\t}\n\n\n\n\n\n\n\n\trender(){\n\t\tconst { currentQuestion } = this.props\n\t\treturn(\n\t\t\t<div className=\"quizHostContainer\">\n\t\t\t<SocketListener isHost socket={this.props.socket} />\n\t\t\t\t{this.props.quizState === 'break' &&\n\t\t\t\t\t<p>Break</p>\n\t\t\t\t}\n\t\t\t\t{(this.props.quizState === 'question' || this.props.quizState === 'answer') &&\n\t\t\t\t\t<div className=\"sceneContainer\">\n\t\t\t\t\t<Question question={currentQuestion} quizState={this.props.quizState}/>\n\t\t\t\t\t<div className=\"responsesContainerHost\">\n\t\t\t\t\t\t{this.props.players && this.props.players.map((player, i) => {\n\t\t\t\t\t\t\tif (player){\n\t\t\t\t\t\t\t\treturn(\n\t\t\t\t\t\t\t\t\t<PlayerResponse key={i} bonus={player.bonus} response={this.props.responses.find(r => r.id === player.id)} {...player} quizState={this.props.quizState}/>\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\treturn(\n\t\t\t\t\t\t\t\t\t<div key={i}/>\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})}\n\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t}\n\t\t\t\t{this.props.quizState === 'end' &&\n\t\t\t\t\t<p>End</p>\n\t\t\t\t}\n\t\t\t</div>\n\t\t)\n\t}\n}\n\n\nconst mapStateToProps = state => ({\n\troom: state.generalHost.room,\n\tstartTime: state.quizHost.startTime,\n\tplayers: state.generalHost.players,\n\trouter: state.router,\n\tresponses: state.quizHost.responses,\n\tquizPlayers: state.quizHost.players,\n\tcurrentQuestion: state.quizHost.currentQuestion,\n\tquizState: state.quizHost.quizState,\n\n})\n\nconst mapDispatchToProps = dispatch => bindActionCreators({\n  push: (path) => push(path),\n  setupGame,\n  updatePlayers,\n  showAnswer,\n  showQuestionHost,\n  showScores,\n}, dispatch)\n\nexport default connect(\n  mapStateToProps,\n  mapDispatchToProps\n)(QuizHost)"]},"metadata":{},"sourceType":"module"}